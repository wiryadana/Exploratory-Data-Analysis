---
title: "College Costs"
author: "Eric Fletcher"
date: "7/30/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Import Data}
#Pulling data from https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-03-10/readme.md

tuition_cost <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-10/tuition_cost.csv')

tuition_income <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-10/tuition_income.csv') 

salary_potential <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-10/salary_potential.csv')

historical_tuition <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-10/historical_tuition.csv')

diversity_school <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-10/diversity_school.csv')
```
```{r Import Libraries}
library(tidyverse)
library(scales)
theme_set(theme_light()) #my default theme inspired by the talented David Robinson (https://www.youtube.com/channel/UCeiiqmVK07qhY-wvg3IZiZQ)
```

```{r Raw Data Inspection / Global Manipulations}
#tuition_cost seems like a good start.

glimpse(tuition_cost) #2,973 rows & 10 columns
summary(tuition_cost) #large range between the lowest and highest costs

tuition_cost_clean <- tuition_cost %>% 
  rename(state_abbr = state_code) #rename the state_code column to state_abbr
```

```{r NA Counts}
##NA counts

#tidyverse approach
na_count <- tuition_cost_clean %>% 
  summarise_all(~ sum(is.na(.)/nrow(tuition_cost_clean))) 
#room_and_board has 1,094 NA's, or 0.367% of the included colleges do not have room and board available
#state has 52 NA's, or 0.017% - not a big deal

#base approach 
na_counts <- sapply(tuition_cost_clean, function(x) sum(length(which(is.na(x))))/nrow(tuition_cost_clean))
```

```{r EDA Tuition Cost}
colnames(tuition_cost_clean)
# [1] "name"                 "state"                "state_abbr"           "type"                 "degree_length"       
# [6] "room_and_board"       "in_state_tuition"     "in_state_total"       "out_of_state_tuition" "out_of_state_total" 

##Look at the distributions

#in_state_total
tuition_cost_clean %>% 
  ggplot(aes(in_state_total)) +
  geom_histogram(bins = 100) +
  scale_x_continuous(labels = scales::comma) #majority of tuition is between $0 and $20,000

#out-of-state-total
tuition_cost_clean %>% 
  ggplot(aes(out_of_state_total)) +
  geom_histogram(bins = 100) +
  scale_x_continuous(labels = scales::comma) #majority of tuition is between $0 and $20,000

##Look at the counts for the various features that comprise the data. Try and use it to inform your questions.
tuition_cost_clean %>% 
  count()

##QUESTION: What are the most expensive 4-year colleges in the US by in-state total?
tuition_cost_clean %>% 
  mutate(name = reorder(name, in_state_total)) %>% 
  filter(degree_length == "4 Year") %>% 
  top_n(20) %>% 
  arrange(desc(in_state_total)) %>% 
  ggplot(aes(x = name, y = in_state_total))+
  geom_point() + 
  geom_segment(aes(x = name, xend = name, y = 0, yend = in_state_total))+
  coord_flip()+
  scale_y_continuous(labels = scales::"comma")+
  labs(title = "2018-2019: Most Expensive 4-Year Colleges",
       subtitle = "In-State Total (sum of room & board + tuition)",
       x = "",
       y = "Cost (USD)")

##QUESTION: Percent difference between the most expensive and inexpensive colleges per state with costs that include both tuition AND room and board?
tuition_cost_clean %>% 
  filter(!is.na(room_and_board),
         degree_length == "4 Year",
         type == "Public") %>% #change to Private for private colleges 
  arrange(state, desc(in_state_total)) %>%
  group_by(state_abbr) %>% 
  slice(which.max(in_state_total), which.min(in_state_total)) %>% 
  mutate(pct_change = round(-diff(in_state_total) / max(in_state_total),4)) %>% #percent change to create a ranking for plot
  ungroup() %>% 
  top_n(n = 24, wt = pct_change) %>% 
  select(name, state_abbr, in_state_total, pct_change) %>% 
  mutate(label=paste(pct_change * 100,"%"),
         label = factor(label, levels = unique(label[order(-pct_change)]))) %>% 
  ggplot(aes(x = state_abbr, y = in_state_total, fill = name))+
  geom_bar(stat = "identity", position = "dodge", width = 0.4)+
  facet_wrap(~label, scales = "free")+
  labs(title = "Percent Difference Between Highest and Lowest Costing Public 4-Year Colleges",
       subtitle = "By State, Sum of Room & Board + Tuition (2018-2019)",
       x = "State",
       y = "In-State Total Cost")+
  theme(legend.position = "none",
        strip.text = element_text(color = "black", face = "bold", size = 10),
        plot.title = element_text(size = 12),
        plot.subtitle = element_text(size = 10),
        axis.text.y = element_text(size = 10),
        axis.text.x = element_text(size = 10),
        axis.title.y = element_text(size = 12),
        axis.title.x = element_text(size = 12))+
  scale_y_continuous(labels = scales::dollar)

```

